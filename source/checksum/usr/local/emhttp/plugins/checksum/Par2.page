Menu="ChecksumSuite"
Title="Par2 Tools"
Icon="checksum.png"
---
<?

#################################################
##                                             ##
##  Checksum.  Copyright 2015, Andrew Zawadzki ##
##                                             ##
#################################################


$plugin = "checksum";

?>

<script>
var URL= "/plugins/<?=$plugin?>/include/par2exec.php";

$(function()
{

  setInterval(function() { statusDisplay(); },1500);

  var path = "/mnt/user";

  $.post(URL,{action:'display_path',path:path},function(data)
  {
    if (data)
    {
      $("#displaypath").html(data);
    }
  });
});

function statusDisplay()
{
  $.post(URL,{action:'status'}, function(data)
  {
    if (data)
    {
      $("#status").html(data);
    }
  });
}

function changePath()
{
  var path = $("#directory").val();

  $.post(URL,{action:'display_path',path:path},function(data)
  {
    if (data)
    {
      $("#displaypath").html(data);
    }
  });
}

function createPar()
{
  var path = $("#folder").html();

  if ( $("#recursive").is(':checked') )
  {
    var recursive = "recursive";
  } else {
    var recursive = "";
  }
  $("#debug1").html(recursive);
  if ( $("#overwrite").is(':checked') )
  {
    var overwrite = "overwrite";
  } else {
    var overwrite = "";
  }

  var percent = $("#redundancy").val();  

  $("#createButton").prop("disabled",true);

  $.post(URL,{action:'create_par',path:path,percent:percent,overwrite:overwrite,recursive:recursive}, function(data)
  {
    if (data)
    {
      $("#createButton").prop("disabled",false);
    }
  });
}

function logButton(whichLog)
{
  openWindow('/plugins/checksum/scripts/showlog.sh&arg1='+whichLog,'Checksum Log',900,1500);
}

function clearLog()
{
  $.post(URL,{action:'clear_log'});
}

function enableVerify()
{
  if ( ! $("#createButton").prop("disabled") )
  {
    $("#verifyButton").prop("disabled",false);
    $("#repairButton").prop("disabled",false);
  }
}


function verifyPar(verify)
{
  var path = $("#folder").html();
  var par = $("#par2select").val();

  $("#verifyButton").prop("disabled",true);

  $.post(URL,{action:'verify_par',path:path,par:par,verify:verify}, function(data)
  {
    $("#verifyButton").prop("disabled",false);
  });
}


</script>
<span id='status'></span><span style='float:right'><input type='button' value='Clear Log' onclick='clearLog();'><input type='button' value='Show Log' onclick='logButton("par2log.txt");'></input></span>
<span id='job'></span>
<span id='displaypath'></span>
<span id='debug'>yrdy</span>
<span id='folder' hidden></span>
<span id='debug1'></span>
